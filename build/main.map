<<<<<<< Updated upstream
{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/helpers/db.connexion.js","webpack:///external \"express\"","webpack:///external \"bcrypt\"","webpack:///./src/helpers/verifyAuth.js","webpack:///external \"mysql\"","webpack:///external \"express-validator\"","webpack:///external \"socket.io\"","webpack:///external \"passport\"","webpack:///./src/helpers/passport.js","webpack:///./src/index.js","webpack:///external \"cors\"","webpack:///external \"express-csp-header\"","webpack:///external \"morgan\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///./src/sockets/sockets.js","webpack:///external \"express-session\"","webpack:///external \"express-mysql-session\"","webpack:///external \"passport-local\"","webpack:///./src/routes/users.js","webpack:///./src/routes/rooms.js","webpack:///external \"moment\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","connection","require","createConnection","host","user","password","port","database","multipleStatements","connect","err","console","log","query","result","req","res","next","isAuthenticated","send","status","message","__webpack_exports__","LocalStrategy","Strategy","bcrypt","passport","use","usernameField","passwordField","passReqToCallback","email","done","results","fields","length","hashedPassword","compare","response","serializeUser","userID","deserializeUser","id","express","cors","csp","morgan","bodyParser","cookieParser","expressValidator","verifiedAuth","connectIO","session","MySQLStore","default","app","static","process","sendFile","root","env","PORT","io","listen","policies","default-src","NONE","img-src","SELF","origin","methods","credentials","json","urlencoded","extended","sessionMiddleware","secret","store","resave","saveUninitialized","cookie","maxAge","socket","request","initialize","userRouter","roomRouter","username","role","server","on","data","emit","socketUser","user_id","user_role","roomData","roomName","roomID","authorLastname","authorFirstname","join","in","color","tag","time","timestamp","broadcast","to","leave","Router","post","checkBody","notEmpty","len","isEmail","matches","equals","body","errors","validationErrors","JSON","stringify","firstname","confirmedPassword","lastname","avatar","university","saltRounds","hash","success","content","authenticate","login","logout","destroy","clearCookie","moment","params","now","startOf","format","endOf","content1","content2","title","description","authorID","authorUsername","startClass","endClass"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 9);\n","'user strict'\n\nconst mysql = require('mysql');\n\nconst connection = mysql.createConnection({\n  host: \"eu-cdbr-west-02.cleardb.net\",\n  user: \"b7482ad97fe0f8\",\n  password: \"21d314c9\",\n  port: \"3306\",\n  database: \"heroku_7d8051b18f89a33\",\n  multipleStatements: true,\n});\n\nconnection.connect(function(err) {\n  if (err) throw err;\n  console.log(\"DB Connected!\");\n\n  // création de la dB\n  // connection.query(\"CREATE DATABASE IF NOT EXISTS OmnivizTest CHARACTER SET 'utf8'\", function (err, result) {\n  //   if (err) throw err;\n  //   console.log(\"database created\");\n  // });\n\n  connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.users (userID INT NOT NULL UNIQUE AUTO_INCREMENT, username VARCHAR(50) NOT NULL UNIQUE, email VARCHAR(250) NOT NULL UNIQUE, createdat TIMESTAMP, firstname VARCHAR(255), lastname VARCHAR(255), avatar VARCHAR(500), university VARCHAR(255), password VARCHAR(255) NOT NULL, role VARCHAR(30))\", function(err, result) {\n    if (err) throw err;\n    console.log(\"Table users created\")\n  });\n\n  connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.rooms (roomID INT NOT NULL UNIQUE AUTO_INCREMENT, authorID INT NOT NULL, authorUsername VARCHAR(50), authorFirstname VARCHAR(255), authorLastname VARCHAR(255), title VARCHAR(255) NOT NULL, description TEXT, createdat TIMESTAMP , startClass INT, endClass INT, participantsID INT, PRIMARY KEY(roomID), FOREIGN KEY(participantsID) REFERENCES users(userID), FOREIGN KEY(authorID) REFERENCES users(userID))\", function(err, result) {\n    if (err) throw err;\n    console.log(\"Table rooms created\")\n  });\n\n  connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.tags (tagID INT NOT NULL UNIQUE AUTO_INCREMENT, userID INT NOT NULL, roomID INT NOT NULL, time INT NOT NULL, color VARCHAR(40), PRIMARY KEY(tagID), FOREIGN KEY(userID) REFERENCES users(userID), FOREIGN KEY(roomID) REFERENCES rooms(roomID))\", function(err, result) {\n    if (err) throw err;\n    console.log(\"Table tags created\")\n  });\n\n  // création d'une table de composition (association many to many) avec clé primaire composite et 2 foreign key\n  connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.Participants (roomID INT NOT NULL, userID INT NOT NULL, CONSTRAINT FK_ParticipantsRooms FOREIGN KEY(roomID) REFERENCES rooms(roomID), CONSTRAINT FK_ParticipantsUsers FOREIGN KEY(userID) REFERENCES users(userID), CONSTRAINT PK_Participants PRIMARY KEY(roomID, userID))\", function(err, result) {\n    if (err) throw err;\n    console.log(\"Table Participants created\")\n  });\n});\n\nmodule.exports = connection","module.exports = require(\"express\");","module.exports = require(\"bcrypt\");","const verifiedAuth = function (req, res, next) {\n  // if (req.isAuthenticated()) {\n  //   // req.user is available for use here\n  //   return next(); }\n  //   else {res.send({status: 401, message:'unauthorized'})}\n    if (req.isAuthenticated()) {\n      console.log('verifiedAuth :', req.isAuthenticated())\n      // req.user is available for use here\n      // res.send({status: 200, message: 'user identified', isAuthenticated: req.isAuthenticated()})\n      return next();\n    } else {\n      console.log('not authenticated user :', req.isAuthenticated())\n      res.send({status: 401, message:'unauthorized', isAuthenticated: req.isAuthenticated()})}\n};\n\nmodule.exports = verifiedAuth;","module.exports = require(\"mysql\");","module.exports = require(\"express-validator\");","module.exports = require(\"socket.io\");","module.exports = require(\"passport\");","const LocalStrategy   = require('passport-local').Strategy;\nconst bcrypt = require('bcrypt');\nconst connection = require('./db.connexion');\n\n// expose this function to our app using module.exports\nexport default function(passport) {\n\n    // =========================================================================\n    // passport session setup ==================================================\n    // =========================================================================\n    // required for persistent login sessions\n    // passport needs ability to serialize and unserialize users out of session\n\n    // used to serialize the user for the session\n\n\n\n    // =========================================================================\n    // LOCAL SIGNUP ============================================================\n    // =========================================================================\n    // we are using named strategies since we have one for login and one for signup\n    // by default, if there was no name, it would just be called 'local'\n\n    // passport.use(\n    //     'local-signup',\n    //     new LocalStrategy({\n    //         // by default, local strategy uses username and password, we will override with email\n    //         usernameField : 'email',\n    //         passwordField : 'password',\n    //         passReqToCallback : true // allows us to pass back the entire request to the callback\n    //     },\n    //     function(req, email, password, done) {\n    //         // find a user whose email is the same as the forms email\n    //         // we are checking to see if the user trying to register already exists\n    //         connection.query(\"SELECT * FROM users WHERE email = ?\",[email], function(err, result, fields) {\n    //             if (err)\n    //                 return done(err);\n    //             if (result.length > 0) {\n    //                 console.log('email already in use')\n    //                 return done(null, false, req.flash('signupMessage', 'Email is already in use.'));\n    //             } else {\n    //                 // if there is no user with that email\n    //                 // create the user\n    //                 var newUserMysql = {\n    //                     username: email,\n    //                     password: bcrypt.hashSync(password, null, null)  // use the generateHash function in our user model\n    //                 };\n\n    //                 var insertQuery = \"INSERT INTO users ( email, password ) values (?,?)\";\n\n    //                 connection.query(insertQuery,[newUserMysql.email, newUserMysql.password],function(err, rows) {\n    //                     newUserMysql.id = rows.insertId;\n\n    //                     return done(null, newUserMysql);\n    //                 });\n    //             }\n    //         });\n    //     })\n    // );\n\n    // =========================================================================\n    // LOCAL LOGIN =============================================================\n    // =========================================================================\n\n    passport.use(new LocalStrategy({\n            // by default, local strategy uses username and password, we will override with email\n            usernameField : 'email',\n            passwordField : 'password',\n            passReqToCallback : true // allows us to pass back the entire request to the callback\n        },\n        function(req, email, password, done) { // callback with email and password from our form\n            connection.query(\"SELECT * FROM users WHERE email = ?\",[email], function(err, results, fields, user){\n                if (err)\n                    return done(err);\n                if (results.length === 0) {\n                    // console.log('no user found');\n                    // res.send('no user found')\n                    return done(null, false, { message : 'no user found' });\n                } else {\n                    let hashedPassword = results[0].password;\n                    // if the user is found but the password is wrong\n                    bcrypt.compare(password, hashedPassword, function(err, response){\n                        if(response){\n                            // all is well, return successful user\n                            const user = results[0]\n                            console.log('user :', user)\n                            // res.send({status: 200, user: user})\n                            return done(null, user, { message : 'user identified'});\n                        } else {\n                                console.log('wrong password')\n                                // res.send({status: 403, errors: 'wrong password'})\n                                return done(null, false, { message: 'incorrect password'}); // create the loginMessage and save it to session as flashdata\n                            }\n                        // if(err) {\n                        //     console.log(err);\n                        //     return done(null, false, {err: err});\n                        // } else if(response) {\n                        //     const user = results[0];\n                        //     console.log('identified user', user);\n                        //     return done(null, user);\n                        //     }\n                        });\n                    }\n                })\n            }\n        )\n    )\n\n    passport.serializeUser(function(user, done) {\n        console.log('serialize usr_id: ', user.userID)\n\n        done(null, user);\n    });\n\n    // used to deserialize the user\n    passport.deserializeUser(function(user, done) {\n\n        const id = user.userID\n        console.log('deserialize usr id: ', id)\n        connection.query(\"SELECT * FROM users WHERE userID = ? \",[id], function(err, user){\n            done(null, user);\n            // console.log('user : ', user)\n        });\n    });\n};","const express = require ('express');\nconst cors = require('cors');\nconst csp = require('express-csp-header');\nconst morgan = require('morgan');\nconst bodyParser = require('body-parser');\nconst cookieParser = require('cookie-parser');\nconst expressValidator = require('express-validator');\nconst bcrypt = require('bcrypt');\n// import { verifiedAuth } from './helpers/verifyAuth';\nconst verifiedAuth = require('./helpers/verifyAuth');\nconst connectIO = require('./sockets/sockets.js')\n// import connection from './helpers/db.connexion';\n//authentication packages\nconst session = require('express-session');\nconst MySQLStore = require('express-mysql-session')(session);\nconst passport = require('passport');\n// const passportSocketIo = require(\"passport.socketio\");\n\nrequire('./helpers/passport').default(passport);\n\n\nconst app = express();\n\n// static files\napp.use(express.static('public'));\n\n// Handle production\nif (process.env.NODE_ENV === 'production') {\n  // Static folder\n  console.log('process.env', process.env.NODE_ENV)\n  app.use(express.static('production'));\n\n  // Handle SPA\n  app.get(/.*/, (req, res) => res.sendFile('/production/index.html', { root : '/app' }));\n}\n\n\nconst port = process.env.PORT || 5000;\nconst server = app.listen(port, () => console.log(`server is running on port ${port}`));\n\nconst io = connectIO(server)\n\n\n\n//logger\napp.use(morgan('combined'));\n\n\n// Content Security Policy (CSP)\napp.use(csp({\n    policies: {\n        'default-src': [csp.NONE],\n        'img-src': [csp.SELF],\n    }\n}));\n//CROSS ORIGINS\napp.use(cors({\n  origin:'http://localhost:8080',\n  methods:['GET', 'POST', 'PUT', 'DELETE'],\n  credentials: true\n}));\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(expressValidator());\n\n//mySQLStore\nconst options = {\n  host: 'eu-cdbr-west-02.cleardb.net',\n  user: \"b7482ad97fe0f8\",\n  password: \"21d314c9\",\n  port: \"3306\",\n  database: 'heroku_7d8051b18f89a33'\n};\nconst sessionStore = new MySQLStore(options);\n\n// express sessions\nconst sessionMiddleware = session({\n  secret: 'thedudeabides',\n  name: 'sid',\n  store: sessionStore,\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    maxAge: 5400000\n  }\n  // cookie: { secure: true }\n});\napp.use(sessionMiddleware);\n\n// map la session express avec une session socket\nio.use(function (socket, next) {\n  sessionMiddleware(socket.request, socket.request.res, next);\n});\n\n// passport session\napp.use(passport.initialize());\napp.use(passport.session());\n\n\n//routes\nconst userRouter = require('./routes/users').default(io, passport, app);\nconst roomRouter = require('./routes/rooms').default(io, passport, app);\napp.use('/users', userRouter);\napp.use('/rooms', roomRouter)\n\n\napp.get('/', verifiedAuth, (req, res, next) => {\n  const user = req.user[0];\n  const userdata = {\n    username: user.username,\n    email: user.email,\n    role: user.role\n  };\n  // res.send({userdata: userdata, isAuthenticated: req.isAuthenticated()})\n  // console.log('get req session user', req.session.passport)\n  // console.log('username', req.username)\n  console.log('isAuthenticated :', req.isAuthenticated())\n})\n","module.exports = require(\"cors\");","module.exports = require(\"express-csp-header\");","module.exports = require(\"morgan\");","module.exports = require(\"body-parser\");","module.exports = require(\"cookie-parser\");","const connection = require('../helpers/db.connexion');\n\nconst socket = require ('socket.io');\n\nfunction connectIO(server) {\n\n  // Socket Setup\n  const io = socket(server);\n\n    // sockets\n  io.on('connection', function(socket, message) {\n\n    //  on peut récupérer le user serialisé par passport et présent dans l'objet socket.request.session. Les infos de ce user sont disponible pour utilisation dans le reste de l'app\n    console.log('A client has connected');\n    // console.log('the socket session object', socket.request.session);\n    // console.log('the actual serialized user from passport', socket.request.session.passport);\n    // const { username } = socket.request.session.passport.user\n    // console.log(`${username} has opened a socket`)\n\n    socket.on('createRoom', (data) => {\n      console.log(data);\n\n      socket.emit('roomCreation', function(data) {\n        console.log(data)\n      });\n    })\n\n    socket.on('join', (data) => {\n      // console.log('room data :', data)\n      if ( socket.request.session.passport.user) {\n\n        const socketUser =  socket.request.session.passport.user\n        console.log('scoket user', socketUser)\n        const username = socketUser.username;\n        const user_id = socketUser.userID;\n        const user_role = socketUser.role;\n        const roomData = data;\n        const roomName = data.roomName;\n        const roomID = data.roomID;\n        const authorLastname = data.authorLastname;\n        const authorFirstname = data.authorFirstname;\n\n        // console.log('room data', roomData)\n\n        console.log('socket:', socketUser)\n\n        socket.join(roomID, function() {\n          console.log('room data', roomData)\n          console.log(`${username} has joined ${roomName}`);\n          console.log('author last name', authorLastname)\n          io.in(roomID).emit('joiningEvent', (\n            {\n            message: `${username} has joined room ${roomName}`,\n            username,\n            user_id,\n            user_role,\n            roomData\n          }));\n\n          // insert les participants au cours dans la table participants que si ils ne sont pas déjà enregistré pour ce cours\n          let query = `INSERT IGNORE INTO Participants (userID, roomID) VALUES ('${user_id}', '${roomID}')`;\n\n          connection.query(query, (err, results, fields) => {\n            if (err) {\n              console.log(err);\n            } else {\n              console.log(results);\n            }\n          })\n        });\n\n        socket.on('tag', (data) => {\n          console.log('tag datas', data)\n          const color = data.tag;\n          const  time = data.timestamp;\n          console.log(username)\n\n          socket.broadcast.to(roomID).emit('event', {\n            color,\n            username,\n            user_id,\n            roomName,\n            time,\n          })\n\n          let query = `INSERT INTO tags (userID, roomID, time, color) VALUES ('${user_id}', '${roomID}', '${time}', '${color}')`;\n\n          connection.query(query, (err, results, fields) => {\n            if (err) {\n              console.log(err);\n            } else {\n              console.log(results);\n            }\n          })\n        });\n\n        socket.on('disconnect', (data) => {\n          console.log('disconnection :', data)\n          // const username = socketUser[0].username;\n          // const user_id = socketUser[0].userID\n          // const room = data.room;\n          // console.log(room)\n          // socket.leave(room, console.log(`${username} has left ${room}`));\n          // socket.broadcast.to(room).emit('leavingEvent',({ message: `${username} has left the room ${room}`}));\n        });\n\n        socket.on('leave', function (data) {\n          console.log(`${username} has left the ${roomName}`)\n          console.log(data)\n\n          socket.leave(roomID, function(data) {\n            socket.broadcast.to(roomID).emit('leavingEvent', ({\n              message: `${username} has left ${roomName}`,\n              username,\n              user_id,\n              user_role,\n            }));\n          });\n        });\n\n        socket.on('closeRoom', function(data) {\n          console.log('classe fermée :', data)\n          socket.broadcast.to(roomID).emit('closeRoom')\n        });\n      } else {\n        //Ne marche pas...trouver la solution\n        console.log(\"c'est la merde\")\n      }\n    });\n  });\n\n  return io\n}\n\nmodule.exports = connectIO;\n\n","module.exports = require(\"express-session\");","module.exports = require(\"express-mysql-session\");","module.exports = require(\"passport-local\");","const express = require('express')\nconst connection = require ('../helpers/db.connexion');\n// import { verifiedAuth } from '../helpers/verifyAuth';\nconst verifiedAuth = require('../helpers/verifyAuth');\nconst mysql = require('mysql');\nconst expressValidator = require('express-validator');\nconst bcrypt = require('bcrypt');\nconst socket = require ('socket.io');\nconst passport = require('passport');\nrequire('../helpers/passport').default(passport);\n// import { io } from '../index';\n\nconst userRouter = express.Router();\n\nexport default function(app, passport, io) {\n  // userRouter.get('/', verifiedAuth, (req, res, next) => {\n  //   //les data du user authentifié peuvent être retrouvées dans l'objet req.user\n  //   const user = req.user[0];\n  //   const userdata = {\n  //     username: user.username,\n  //     email: user.email,\n  //     role: user.role\n  //   };\n\n  //   //renvoie le user + isAuthenticated à true dans le front\n  //   res.send({status: 200, userdata: userdata, isAuthenticated: req.isAuthenticated()})\n  // });\n\n  userRouter.post('/register', (req, res) => {\n\n    req.checkBody('username', 'Username field cannot be empty.').notEmpty();\n    req.checkBody('username', 'Username must be between 4-15 characters long.').len(4, 15);\n    req.checkBody('email', 'The email you entered is invalid, please try again.').isEmail();\n    req.checkBody('email', 'Email address must be between 4-100 characters long, please try again.').len(4, 100);\n    req.checkBody('email', 'Email field cannot be empty.').notEmpty();\n    req.checkBody('password', 'Password field cannot be empty.').notEmpty();\n    req.checkBody('password', 'Password must be between 8-100 characters long.').len(8, 100);\n    req.checkBody(\"password\", \"Password must include one lowercase character, one uppercase character, a number, and a special character.\").matches(/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.* )(?=.*[^a-zA-Z0-9]).{8,}$/, \"i\");\n    req.checkBody('confirmedPassword', 'Password must be between 8-100 characters long.').len(8, 100);\n    req.checkBody('confirmedPassword', 'Passwords do not match, please try again.').equals(req.body.password);\n\n    const errors = req.validationErrors();\n\n    if (errors) {\n      console.log(`errors: ${JSON.stringify(errors)}`);\n      res.send({\n        status:400,\n        errors: errors\n      });\n    } else {\n      let body = req.body;\n      let email = body.email;\n      let username = body.username;\n      let password = body.password;\n      let confirmedPassword = body.confirmedPassword;\n      let firstname = body.firstname;\n      let lastname = body.lastname;\n      let avatar = body.avatar;\n      let university = body.university;\n      let role = body.role;\n\n      const saltRounds = 10;\n\n      bcrypt.hash(password, saltRounds, function(err, hash) {\n        let query = `INSERT INTO users (email, username, password, firstname, lastname, avatar, university, role) VALUES ('${email}', '${username}', '${hash}', '${firstname}', '${lastname}', '${avatar}', '${university}', '${role}')`;\n\n        connection.query(query, (err, results, fields) => {\n          if (errors) {\n            console.log(errors);\n            res.send({\n              status:400,\n              errors:errors\n            });\n          }else{\n            console.log(results);\n            res.send({\n              status:200,\n              \"success\":\"new user registered sucessfully\",\n              content: results\n            });\n          };\n        });\n      });\n    };\n  });\n\n  userRouter.post('/login', (req, res, next) => {\n    passport.authenticate('local',  (err, user, message) => {\n      if(err){\n        res.send({status: 403, errors: message})\n      }\n      else {\n        req.login(user, (err) => {\n          if(err) {\n            console.log(err)\n          }\n          console.log('authentifié', req.isAuthenticated())\n          res.send({user: user, isAuthenticated: req.isAuthenticated(), message: message.message})\n        })\n      }\n    })(req,res,next);\n  });\n\n  userRouter.get('/logout', (req, res) => {\n    req.logout();\n    req.session.destroy();\n    res.clearCookie('sid')\n\n    //envoie isAuthenticated à false dans le front\n    res.send(({status: 200, isAuthenticated: req.isAuthenticated()}))\n  });\n  return userRouter;\n}","const express = require('express');\nconst connection = require('../helpers/db.connexion');\nconst verifiedAuth = require('../helpers/verifyAuth');\nconst mysql = require('mysql');\nconst moment = require('moment');\n// import { verifiedAuth } from '../helpers/verifyAuth'\nconst roomRouter = express.Router();\n\nexport default function(app, passport, io) {\n\n  //cours classés par ordre id (ordre de création)\n  roomRouter.get('/', verifiedAuth, (req, res) => {\n    // console.log(req.isAuthenticated())\n    connection.query('SELECT * FROM rooms ', (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // liste des cours auquels à participé le user\n  roomRouter.get('/myRooms/:id', verifiedAuth, (req, res) => {\n    // récupération de l'id du user\n    const id = req.params.id;\n    console.log(id)\n\n    // utilisation d'une subquery pour d'abord récupérer l'id des cours auquel le user à participé (table participants). On passe ensuite ces id à la query qui liste les cours\n    const query = `SELECT * FROM rooms WHERE roomID IN (SELECT roomID FROM Participants WHERE userID = ${id})`\n\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });\n  });\n\n  // cours classés par heure de début de classe\n  roomRouter.get('/startDate', verifiedAuth, (req, res) => {\n    connection.query('SELECT * FROM rooms ORDER BY `startClass` DESC', (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // cours du jour\n  roomRouter.get('/classOfTheDay', verifiedAuth, (req, res) => {\n    const now = moment();\n    // date de début du jour sous forme de timestamp en secondes\n    const startOfDay = now.startOf('day').format('X');\n    // date de fin du jour sous forme de timestamp en secondes\n    const endOfDay = now.endOf('day').format('X');\n    // renvoie uniquement les cours de la journée (dont la date de début est compris entre le début de la fin du jour 0h 00m 00sec et 23h 59m 59sec)\n    const query = `SELECT * FROM rooms WHERE startClass >= ${startOfDay} AND startClass <= ${endOfDay}`\n    connection.query(query , (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // cours séléctionné par ID\n  roomRouter.get('/:id', verifiedAuth, (req,res) => {\n    const id = req.params.id;\n    let query = `SELECT rooms.roomID, rooms.authorID, rooms.authorUsername, rooms.authorFirstname, rooms.authorLastname, rooms.title, rooms.startClass, rooms.endClass\n    FROM rooms\n    WHERE rooms.roomID = ${id}; SELECT tags.tagID, tags.userID, tags.time, tags.color\n    FROM tags\n    WHERE tags.roomID = ${id}`;\n    // let query = `SELECT rooms.roomID, rooms.authorID, rooms.authorUsername, rooms.authorFirstname, rooms.authorLastname, rooms.title, rooms.startClass, rooms.endClass, tags.tagID, tags.userID, tags.time, tags.color\n    // FROM rooms\n    // INNER JOIN tags ON rooms.roomID = tags.roomID\n    // WHERE rooms.roomID = ${id}`\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          status:400,\n          errors:err\n        });\n      }else{\n        console.log(results[0]);\n        console.log(results[1]);\n        res.send({\n          status:200,\n          content1: results[0],\n          content2: results[1],\n        });\n      };\n    })\n  })\n\n  roomRouter.post('/', verifiedAuth, (req, res) => {\n\n      req.checkBody('title', 'Title field cannot be empty.').notEmpty();\n\n      const errors = req.validationErrors();\n\n      if (errors) {\n        console.log(`errors: ${JSON.stringify(errors)}`);\n        res.send({\n          status:400,\n          errors: errors\n        });\n      } else {\n        let body = req.body;\n        const { title, description, authorID, authorLastname, authorFirstname, authorUsername, startClass, endClass } = body\n\n        let query = `INSERT INTO rooms (authorID, authorLastname, authorFirstname, authorUsername, title, description, startClass, endClass) VALUES ('${authorID}', '${authorLastname}', '${authorFirstname}', '${authorUsername}', '${title}', '${description}', '${startClass}', '${endClass}')`;\n\n        console.log(query)\n        // const [errors, results] = createRoom(body)\n          connection.query(query, (errors, results, fields) => {\n            if (errors) {\n              console.log(errors);\n              res.send({\n                status:400,\n                errors:errors\n              });\n            } else{\n              console.log(results);\n              res.send({\n                status:200,\n                \"success\":\"new class created\",\n                content: results\n              });\n            };\n          });\n        }\n    });\n  return roomRouter;\n}","module.exports = require(\"moment\");"],"sourceRoot":""}
=======
{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/helpers/db.connexion.js","webpack:///./src/helpers/passport.js","webpack:///./src/helpers/verifyAuth.js","webpack:///./src/index.js","webpack:///./src/routes/rooms.js","webpack:///./src/routes/users.js","webpack:///./src/sockets/sockets.js","webpack:///external \"bcrypt\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"cors\"","webpack:///external \"express\"","webpack:///external \"express-mysql-session\"","webpack:///external \"express-session\"","webpack:///external \"express-validator\"","webpack:///external \"moment\"","webpack:///external \"morgan\"","webpack:///external \"mysql\"","webpack:///external \"passport\"","webpack:///external \"passport-local\"","webpack:///external \"socket.io\""],"names":["mysql","require","db_config","host","user","password","port","database","multipleStatements","connection","handleDisconnect","console","log","createConnection","connect","err","setTimeout","query","result","on","code","module","exports","LocalStrategy","Strategy","bcrypt","passport","use","usernameField","passwordField","passReqToCallback","req","email","done","results","fields","length","message","hashedPassword","compare","response","serializeUser","userID","deserializeUser","id","verifiedAuth","res","next","isAuthenticated","send","status","express","cors","morgan","bodyParser","cookieParser","expressValidator","connectIO","session","MySQLStore","default","app","process","env","PORT","server","listen","io","static","origin","methods","credentials","json","urlencoded","extended","options","sessionStore","sessionMiddleware","secret","name","store","resave","saveUninitialized","cookie","maxAge","socket","request","initialize","userRouter","roomRouter","get","userdata","username","role","moment","Router","params","now","startOfDay","startOf","format","endOfDay","endOf","errors","content1","content2","post","checkBody","notEmpty","validationErrors","JSON","stringify","body","title","description","authorID","authorLastname","authorFirstname","authorUsername","startClass","endClass","content","len","isEmail","matches","equals","confirmedPassword","firstname","lastname","avatar","university","saltRounds","hash","authenticate","login","logout","destroy","clearCookie","data","emit","socketUser","user_id","user_role","roomData","roomName","roomID","join","in","color","tag","time","timestamp","broadcast","to","leave"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","'user strict'\n\nconst mysql = require('mysql');\n\nconst db_config = {\n  host: \"eu-cdbr-west-02.cleardb.net\",\n  user: \"b7482ad97fe0f8\",\n  password: \"21d314c9\",\n  port: \"3306\",\n  database: \"heroku_7d8051b18f89a33\",\n  multipleStatements: true,\n};\n\nlet connection;\n\nfunction handleDisconnect() {\n  console.log('1. connecting to db:');\n  connection = mysql.createConnection(db_config); // Recreate the connection, since\n                        // the old one cannot be reused.\n\n  connection.connect(function(err) {              \t// The server is either down\n      if (err) {                                     // or restarting (takes a while sometimes).\n          console.log('2. error when connecting to db:', err);\n          setTimeout(handleDisconnect, 1000); // We introduce a delay before attempting to reconnect,\n      } // to avoid a hot loop, and to allow our node script to\n                                    \t// process asynchronous requests in the meantime.\n                        // If you're also serving http, display a 503 error.\n      else {\n        console.log(\"DB Connected!\");\n\n        connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.users (userID INT NOT NULL UNIQUE AUTO_INCREMENT, username VARCHAR(50) NOT NULL UNIQUE, email VARCHAR(250) NOT NULL UNIQUE, createdat TIMESTAMP, firstname VARCHAR(255), lastname VARCHAR(255), avatar VARCHAR(500), university VARCHAR(255), password VARCHAR(255) NOT NULL, role VARCHAR(30))\", function(err, result) {\n          if (err) throw err;\n          console.log(\"Table users created\")\n        });\n\n        connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.rooms (roomID INT NOT NULL UNIQUE AUTO_INCREMENT, authorID INT NOT NULL, authorUsername VARCHAR(50), authorFirstname VARCHAR(255), authorLastname VARCHAR(255), title VARCHAR(255) NOT NULL, description TEXT, createdat TIMESTAMP , startClass INT, endClass INT, participantsID INT, PRIMARY KEY(roomID), FOREIGN KEY(participantsID) REFERENCES users(userID), FOREIGN KEY(authorID) REFERENCES users(userID))\", function(err, result) {\n          if (err) throw err;\n          console.log(\"Table rooms created\")\n        });\n\n        connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.tags (tagID INT NOT NULL UNIQUE AUTO_INCREMENT, userID INT NOT NULL, roomID INT NOT NULL, time BIGINT UNSIGNED NOT NULL, color VARCHAR(40), PRIMARY KEY(tagID), FOREIGN KEY(userID) REFERENCES users(userID), FOREIGN KEY(roomID) REFERENCES rooms(roomID))\", function(err, result) {\n          if (err) throw err;\n          console.log(\"Table tags created\")\n        });\n\n        // création d'une table de composition (association many to many) avec clé primaire composite et 2 foreign key\n        connection.query(\"CREATE TABLE IF NOT EXISTS heroku_7d8051b18f89a33.Participants (roomID INT NOT NULL, userID INT NOT NULL, CONSTRAINT FK_ParticipantsRooms FOREIGN KEY(roomID) REFERENCES rooms(roomID), CONSTRAINT FK_ParticipantsUsers FOREIGN KEY(userID) REFERENCES users(userID), CONSTRAINT PK_Participants PRIMARY KEY(roomID, userID))\", function(err, result) {\n          if (err) throw err;\n          console.log(\"Table Participants created\")\n        });\n      }\n  });\n  connection.on('error', function(err) {\n      console.log('3. db error', err);\n      if (err.code === 'PROTOCOL_CONNECTION_LOST') { \t// Connection to the MySQL server is usually\n          handleDisconnect();                      \t// lost due to either server restart, or a\n      } else {                                      \t// connnection idle timeout (the wait_timeout\n          throw err;                                  // server variable configures this)\n      }\n  });\n}\n\nhandleDisconnect();\n\nmodule.exports = connection","const LocalStrategy   = require('passport-local').Strategy;\nconst bcrypt = require('bcrypt');\nimport connection from '../helpers/db.connexion';\n\n// expose this function to our app using module.exports\nexport default function(passport) {\n\n    // =========================================================================\n    // passport session setup ==================================================\n    // =========================================================================\n    // required for persistent login sessions\n    // passport needs ability to serialize and unserialize users out of session\n\n    // used to serialize the user for the session\n\n\n\n    // =========================================================================\n    // LOCAL SIGNUP ============================================================\n    // =========================================================================\n    // we are using named strategies since we have one for login and one for signup\n    // by default, if there was no name, it would just be called 'local'\n\n    // passport.use(\n    //     'local-signup',\n    //     new LocalStrategy({\n    //         // by default, local strategy uses username and password, we will override with email\n    //         usernameField : 'email',\n    //         passwordField : 'password',\n    //         passReqToCallback : true // allows us to pass back the entire request to the callback\n    //     },\n    //     function(req, email, password, done) {\n    //         // find a user whose email is the same as the forms email\n    //         // we are checking to see if the user trying to register already exists\n    //         connection.query(\"SELECT * FROM users WHERE email = ?\",[email], function(err, result, fields) {\n    //             if (err)\n    //                 return done(err);\n    //             if (result.length > 0) {\n    //                 console.log('email already in use')\n    //                 return done(null, false, req.flash('signupMessage', 'Email is already in use.'));\n    //             } else {\n    //                 // if there is no user with that email\n    //                 // create the user\n    //                 var newUserMysql = {\n    //                     username: email,\n    //                     password: bcrypt.hashSync(password, null, null)  // use the generateHash function in our user model\n    //                 };\n\n    //                 var insertQuery = \"INSERT INTO users ( email, password ) values (?,?)\";\n\n    //                 connection.query(insertQuery,[newUserMysql.email, newUserMysql.password],function(err, rows) {\n    //                     newUserMysql.id = rows.insertId;\n\n    //                     return done(null, newUserMysql);\n    //                 });\n    //             }\n    //         });\n    //     })\n    // );\n\n    // =========================================================================\n    // LOCAL LOGIN =============================================================\n    // =========================================================================\n\n    passport.use(new LocalStrategy({\n            // by default, local strategy uses username and password, we will override with email\n            usernameField : 'email',\n            passwordField : 'password',\n            passReqToCallback : true // allows us to pass back the entire request to the callback\n        },\n        function(req, email, password, done) { // callback with email and password from our form\n            connection.query(\"SELECT * FROM users WHERE email = ?\",[email], function(err, results, fields, user){\n                if (err)\n                    return done(err);\n                if (results.length === 0) {\n                    // console.log('no user found');\n                    // res.send('no user found')\n                    return done(null, false, { message : 'no user found' });\n                } else {\n                    let hashedPassword = results[0].password;\n                    // if the user is found but the password is wrong\n                    bcrypt.compare(password, hashedPassword, function(err, response){\n                        if(response){\n                            // all is well, return successful user\n                            const user = results[0]\n                            console.log('user :', user)\n                            // res.send({status: 200, user: user})\n                            return done(null, user, { message : 'user identified'});\n                        } else {\n                                console.log('wrong password')\n                                // res.send({status: 403, errors: 'wrong password'})\n                                return done(null, false, { message: 'incorrect password'}); // create the loginMessage and save it to session as flashdata\n                            }\n                        // if(err) {\n                        //     console.log(err);\n                        //     return done(null, false, {err: err});\n                        // } else if(response) {\n                        //     const user = results[0];\n                        //     console.log('identified user', user);\n                        //     return done(null, user);\n                        //     }\n                        });\n                    }\n                })\n            }\n        )\n    )\n\n    passport.serializeUser(function(user, done) {\n        console.log('serialize usr_id: ', user.userID)\n\n        done(null, user);\n    });\n\n    // used to deserialize the user\n    passport.deserializeUser(function(user, done) {\n\n        const id = user.userID\n        console.log('deserialize usr id: ', id)\n        connection.query(\"SELECT * FROM users WHERE userID = ? \",[id], function(err, user){\n            done(null, user);\n            // console.log('user : ', user)\n        });\n    });\n};","const verifiedAuth = function (req, res, next) {\n  // if (req.isAuthenticated()) {\n  //   // req.user is available for use here\n  //   return next(); }\n  //   else {res.send({status: 401, message:'unauthorized'})}\n    if (req.isAuthenticated()) {\n      console.log('verifiedAuth :', req.isAuthenticated())\n      // req.user is available for use here\n      // res.send({status: 200, message: 'user identified', isAuthenticated: req.isAuthenticated()})\n      return next();\n    } else {\n      console.log('not authenticated user :', req.isAuthenticated())\n      res.send({status: 401, message:'unauthorized', isAuthenticated: req.isAuthenticated()})}\n};\n\nmodule.exports = verifiedAuth;","const express = require ('express');\nconst cors = require('cors');\nconst morgan = require('morgan');\nconst bodyParser = require('body-parser');\nconst cookieParser = require('cookie-parser');\nconst expressValidator = require('express-validator');\nconst bcrypt = require('bcrypt');\n// import { verifiedAuth } from './helpers/verifyAuth';\nconst verifiedAuth = require('./helpers/verifyAuth');\nconst connectIO = require('./sockets/sockets.js')\n// import connection from './helpers/db.connexion';\n\n//authentication packages\nconst session = require('express-session');\nconst MySQLStore = require('express-mysql-session')(session);\nconst passport = require('passport');\n// const passportSocketIo = require(\"passport.socketio\");\n\nrequire('./helpers/passport').default(passport);\n\n\nconst app = express();\n\nconst port = process.env.PORT || 5000;\nconst server = app.listen(port, () => console.log(`server is running on port ${port}`));\n\nconst io = connectIO(server)\n\n//static files\napp.use(express.static('../public'));\n\n//logger\napp.use(morgan('combined'));\n\n//CROSS ORIGINS\napp.use(cors({\n  origin:'http://localhost:8080',\n  methods:['GET', 'POST', 'PUT', 'DELETE'],\n  credentials: true\n}));\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(cookieParser());\napp.use(expressValidator());\n\n//mySQLStore\nconst options = {\n  host: 'localhost',\n  // port: 5000,\n  user: 'root',\n  password: '',\n  database: 'OmnivizTest'\n};\nconst sessionStore = new MySQLStore(options);\n\n// express sessions\nconst sessionMiddleware = session({\n  secret: 'thedudeabides',\n  name: 'sid',\n  store: sessionStore,\n  resave: false,\n  saveUninitialized: false,\n  cookie: {\n    maxAge: 5400000\n  }\n  // cookie: { secure: true }\n});\napp.use(sessionMiddleware);\n\n// map la session express avec une session socket\nio.use(function (socket, next) {\n  sessionMiddleware(socket.request, socket.request.res, next);\n});\n\n// passport session\napp.use(passport.initialize());\napp.use(passport.session());\n\n\n//routes\nconst userRouter = require('./routes/users').default(io, passport, app);\nconst roomRouter = require('./routes/rooms').default(io, passport, app);\napp.use('/users', userRouter);\napp.use('/rooms', roomRouter)\n\n\napp.get('/', verifiedAuth, (req, res, next) => {\n  const user = req.user[0];\n  const userdata = {\n    username: user.username,\n    email: user.email,\n    role: user.role\n  };\n  // res.send({userdata: userdata, isAuthenticated: req.isAuthenticated()})\n  // console.log('get req session user', req.session.passport)\n  // console.log('username', req.username)\n  console.log('isAuthenticated :', req.isAuthenticated())\n})\n","const express = require('express');\nconst connection = require('../helpers/db.connexion');\nconst verifiedAuth = require('../helpers/verifyAuth');\nconst mysql = require('mysql');\nconst moment = require('moment');\n// import { verifiedAuth } from '../helpers/verifyAuth'\nconst roomRouter = express.Router();\n\nexport default function(app, passport, io) {\n\n  //cours classés par ordre id (ordre de création)\n  roomRouter.get('/', verifiedAuth, (req, res) => {\n    // console.log(req.isAuthenticated())\n    // const query =`\n    // SELECT *, Participants.userID\n    // FROM rooms\n    // INNER JOIN Participants\n    // ON rooms.roomID = Participants.roomID`;\n    connection.query('SELECT * FROM rooms ', (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // liste des cours auquels à participé le user\n  roomRouter.get('/myRooms/:id', verifiedAuth, (req, res) => {\n    // récupération de l'id du user\n    const id = req.params.id;\n    console.log(id)\n\n    // utilisation d'une subquery pour d'abord récupérer l'id des cours auquel le user à participé (table participants). On passe ensuite ces id à la query qui liste les cours\n    const query = `SELECT * FROM rooms WHERE roomID IN (SELECT roomID FROM Participants WHERE userID = ${id})`\n\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });\n  });\n\n  // cours classés par heure de début de classe\n  roomRouter.get('/startDate', verifiedAuth, (req, res) => {\n    connection.query('SELECT * FROM rooms ORDER BY `startClass` DESC', (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // cours du jour\n  roomRouter.get('/classOfTheDay', verifiedAuth, (req, res) => {\n    const now = moment();\n    // date de début du jour sous forme de timestamp en secondes\n    const startOfDay = now.startOf('day').format('X');\n    // date de fin du jour sous forme de timestamp en secondes\n    const endOfDay = now.endOf('day').format('X');\n    // renvoie uniquement les cours de la journée (dont la date de début est compris entre le début de la fin du jour 0h 00m 00sec et 23h 59m 59sec)\n    const query = `SELECT * FROM rooms WHERE startClass >= ${startOfDay} AND startClass <= ${endOfDay}`\n    connection.query(query , (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          err\n        })\n      } else {\n        console.log(results)\n        res.status(200).send({status: true, results: results});\n      }\n    });;\n  });\n\n  // timeline séléctionnée par ID\n  roomRouter.get('/timeline/:id', verifiedAuth, (req,res) => {\n    const id = req.params.id;\n    let query = `SELECT rooms.roomID, rooms.authorID, rooms.authorUsername, rooms.authorFirstname, rooms.authorLastname, rooms.title, rooms.startClass, rooms.endClass\n    FROM rooms\n    WHERE rooms.roomID = ${id};\n\n    SELECT tags.tagID, tags.userID, tags.time, tags.color, users.userID, users.username, users.firstname, users.lastname, users.email, users.avatar\n    FROM tags\n    INNER JOIN users\n    ON tags.userID = users.userID\n    WHERE tags.roomID = ${id}\n    `;\n    // SELECT tags.tagID, tags.userID, tags.time, tags.color\n    // FROM tags\n    // WHERE tags.roomID = ${id};\n\n    // SELECT *\n    // FROM users\n    // WHERE userID\n    // IN (SELECT userID FROM Participants WHERE roomID = ${id})\n\n    // let query = `SELECT rooms.roomID, rooms.authorID, rooms.authorUsername, rooms.authorFirstname, rooms.authorLastname, rooms.title, rooms.startClass, rooms.endClass, tags.tagID, tags.userID, tags.time, tags.color\n    // FROM rooms\n    // INNER JOIN tags ON rooms.roomID = tags.roomID\n    // WHERE rooms.roomID = ${id}`\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          status:400,\n          errors:err\n        });\n      }else{\n        console.log(results[0]);\n        console.log(results[1]);\n        res.send({\n          status:200,\n          content1: results[0],\n          content2: results[1],\n        });\n      };\n    })\n  })\n\n  // single cours (par id)\n  roomRouter.get('/:id', verifiedAuth, (req,res) => {\n    const id = req.params.id;\n    let query = `SELECT rooms.roomID, rooms.authorID, rooms.authorUsername, rooms.authorFirstname, rooms.authorLastname, rooms.title, rooms.startClass, rooms.endClass\n    FROM rooms\n    WHERE rooms.roomID = ${id}`;\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.send({\n          status:400,\n          errors:err\n        });\n      }else{\n        console.log(results);\n        res.send({\n          status:200,\n          results,\n        });\n      };\n    })\n  });\n\n  // séléctionne tous les participants à un cours et récupère leur datas utilisateur\n  roomRouter.get('/participants/:id', verifiedAuth, (req, res) => {\n    const id = req.params.id\n    const query =\n      `SELECT Participants.userID, users.username, users.firstname, users.lastname\n      FROM Participants\n      INNER JOIN users\n      ON Participants.userID = users.userID\n      WHERE roomID = ${id}`;\n      connection.query(query, (err, results, fields) => {\n        if (err) {\n          console.log(err);\n          res.send({\n            status:400,\n            errors:err\n          });\n        }else{\n          console.log(results);\n          res.send({\n            status:200,\n            results,\n          });\n        }\n      });\n  });\n\n  roomRouter.post('/', verifiedAuth, (req, res) => {\n\n      req.checkBody('title', 'Title field cannot be empty.').notEmpty();\n\n      const errors = req.validationErrors();\n\n      if (errors) {\n        console.log(`errors: ${JSON.stringify(errors)}`);\n        res.send({\n          status:400,\n          errors: errors\n        });\n      } else {\n        let body = req.body;\n        const { title, description, authorID, authorLastname, authorFirstname, authorUsername, startClass, endClass } = body\n\n        let query = `INSERT INTO rooms (authorID, authorLastname, authorFirstname, authorUsername, title, description, startClass, endClass) VALUES ('${authorID}', '${authorLastname}', '${authorFirstname}', '${authorUsername}', '${title}', '${description}', '${startClass}', '${endClass}')`;\n\n        console.log(query)\n        // const [errors, results] = createRoom(body)\n          connection.query(query, (errors, results, fields) => {\n            if (errors) {\n              console.log(errors);\n              res.send({\n                status:400,\n                errors:errors\n              });\n            } else{\n              console.log(results);\n              res.send({\n                status:200,\n                \"success\":\"new class created\",\n                content: results\n              });\n            };\n          });\n        }\n    });\n  return roomRouter;\n}","const express = require('express')\nimport connection from '../helpers/db.connexion';\n// import { verifiedAuth } from '../helpers/verifyAuth';\nconst verifiedAuth = require('../helpers/verifyAuth');\nconst mysql = require('mysql');\nconst expressValidator = require('express-validator');\nconst bcrypt = require('bcrypt');\nconst socket = require ('socket.io');\nconst passport = require('passport');\nrequire('../helpers/passport').default(passport);\n// import { io } from '../index';\n\nconst userRouter = express.Router();\n\nexport default function(app, passport, io) {\n  // userRouter.get('/', verifiedAuth, (req, res, next) => {\n  //   //les data du user authentifié peuvent être retrouvées dans l'objet req.user\n  //   const user = req.user[0];\n  //   const userdata = {\n  //     username: user.username,\n  //     email: user.email,\n  //     role: user.role\n  //   };\n\n  //   //renvoie le user + isAuthenticated à true dans le front\n  //   res.send({status: 200, userdata: userdata, isAuthenticated: req.isAuthenticated()})\n  // });\n\n  userRouter.post('/register', (req, res) => {\n\n    req.checkBody('username', 'Username field cannot be empty.').notEmpty();\n    req.checkBody('username', 'Username must be between 4-15 characters long.').len(4, 15);\n    req.checkBody('email', 'The email you entered is invalid, please try again.').isEmail();\n    req.checkBody('email', 'Email address must be between 4-100 characters long, please try again.').len(4, 100);\n    req.checkBody('email', 'Email field cannot be empty.').notEmpty();\n    req.checkBody('password', 'Password field cannot be empty.').notEmpty();\n    req.checkBody('password', 'Password must be between 8-100 characters long.').len(8, 100);\n    req.checkBody(\"password\", \"Password must include one lowercase character, one uppercase character, a number, and a special character.\").matches(/^(?=.*\\d)(?=.*[a-z])(?=.*[A-Z])(?!.* )(?=.*[^a-zA-Z0-9]).{8,}$/, \"i\");\n    req.checkBody('confirmedPassword', 'Password must be between 8-100 characters long.').len(8, 100);\n    req.checkBody('confirmedPassword', 'Passwords do not match, please try again.').equals(req.body.password);\n\n    const errors = req.validationErrors();\n\n    if (errors) {\n      console.log(`errors: ${JSON.stringify(errors)}`);\n      res.send({\n        status:400,\n        errors: errors\n      });\n    } else {\n      let body = req.body;\n      let email = body.email;\n      let username = body.username;\n      let password = body.password;\n      let confirmedPassword = body.confirmedPassword;\n      let firstname = body.firstname;\n      let lastname = body.lastname;\n      let avatar = body.avatar;\n      let university = body.university;\n      let role = body.role;\n\n      const saltRounds = 10;\n\n      bcrypt.hash(password, saltRounds, function(err, hash) {\n        let query = `INSERT INTO users (email, username, password, firstname, lastname, avatar, university, role) VALUES ('${email}', '${username}', '${hash}', '${firstname}', '${lastname}', '${avatar}', '${university}', '${role}')`;\n\n        connection.query(query, (err, results, fields) => {\n          if (errors) {\n            console.log(errors);\n            res.send({\n              status:400,\n              errors:errors\n            });\n          }else{\n            console.log(results);\n            res.send({\n              status:200,\n              \"success\":\"new user registered sucessfully\",\n              content: results\n            });\n          };\n        });\n      });\n    };\n  });\n\n  userRouter.post('/login', (req, res, next) => {\n    passport.authenticate('local',  (err, user, message) => {\n      if(err){\n        res.send({status: 403, errors: message})\n      }\n      else {\n        req.login(user, (err) => {\n          if(err) {\n            console.log(err)\n          }\n          console.log('authentifié', req.isAuthenticated())\n          res.send({user: user, isAuthenticated: req.isAuthenticated(), message: message.message})\n        })\n      }\n    })(req,res,next);\n  });\n\n  userRouter.get('/logout', (req, res) => {\n    req.logout();\n    req.session.destroy();\n    res.clearCookie('sid')\n\n    //envoie isAuthenticated à false dans le front\n    res.send(({status: 200, isAuthenticated: req.isAuthenticated()}))\n  });\n  return userRouter;\n}","const connection = require('../helpers/db.connexion');\n\nconst socket = require ('socket.io');\n\nfunction connectIO(server) {\n\n  // Socket Setup\n  const io = socket(server);\n\n    // sockets\n  io.on('connection', function(socket, message) {\n\n    //  on peut récupérer le user serialisé par passport et présent dans l'objet socket.request.session. Les infos de ce user sont disponible pour utilisation dans le reste de l'app\n    console.log('A client has connected');\n    // console.log('the socket session object', socket.request.session);\n    // console.log('the actual serialized user from passport', socket.request.session.passport);\n    // const { username } = socket.request.session.passport.user\n    // console.log(`${username} has opened a socket`)\n\n    socket.on('createRoom', (data) => {\n      console.log(data);\n\n      socket.emit('roomCreation', function(data) {\n        console.log(data)\n      });\n    })\n\n    socket.on('join', (data) => {\n      console.log('room data :', data)\n      if ( socket.request.session.passport.user) {\n\n        const socketUser =  socket.request.session.passport.user\n        console.log('scoket user', socketUser)\n        const username = socketUser.username;\n        const user_id = socketUser.userID;\n        const user_role = socketUser.role;\n        const roomData = data;\n        const roomName = data.roomName;\n        const roomID = data.roomID;\n        const authorLastname = data.authorLastname;\n        const authorFirstname = data.authorFirstname;\n\n        // console.log('room data', roomData)\n\n        console.log('socket:', socketUser)\n\n        socket.join(roomID, function() {\n          console.log('room data', roomData)\n          console.log(`${username} has joined ${roomName}`);\n          console.log('author last name', authorLastname)\n          io.in(roomID).emit('joiningEvent', (\n            {\n            message: `${username} has joined room ${roomName}`,\n            username,\n            user_id,\n            user_role,\n            roomData\n          }));\n\n          // insert les participants au cours dans la table participants que si ils ne sont pas déjà enregistré pour ce cours\n          let query = `INSERT IGNORE INTO Participants (userID, roomID) VALUES ('${user_id}', '${roomID}')`;\n\n          connection.query(query, (err, results, fields) => {\n            if (err) {\n              console.log(err);\n            } else {\n              console.log(results);\n            }\n          })\n        });\n\n        socket.on('tag', (data) => {\n          console.log('tag datas', data)\n          const color = data.tag;\n          const  time = data.timestamp;\n          console.log('time', time)\n          console.log(username)\n\n          socket.broadcast.to(roomID).emit('event', {\n            color,\n            username,\n            user_id,\n            roomName,\n            time,\n          })\n\n          let query = `INSERT INTO tags (userID, roomID, time, color) VALUES ('${user_id}', '${roomID}', '${time}', '${color}')`;\n\n          connection.query(query, (err, results, fields) => {\n            if (err) {\n              console.log(err);\n            } else {\n              console.log(results);\n            }\n          })\n        });\n\n        socket.on('disconnect', (data) => {\n          console.log('disconnection :', data)\n          // const username = socketUser[0].username;\n          // const user_id = socketUser[0].userID\n          // const room = data.room;\n          // console.log(room)\n          // socket.leave(room, console.log(`${username} has left ${room}`));\n          // socket.broadcast.to(room).emit('leavingEvent',({ message: `${username} has left the room ${room}`}));\n        });\n\n        socket.on('leave', (data) => {\n          console.log(`${username} has left the ${roomName}`)\n          console.log(data)\n\n          socket.leave(roomID, data => {\n            socket.broadcast.to(roomID).emit('leavingEvent', ({\n              message: `${username} has left ${roomName}`,\n              username,\n              user_id,\n              user_role,\n            }));\n          });\n        });\n\n        socket.on('closeRoom', () => {\n          // on devrait pouvoir récupérer le username envoyé depuis le front via closeRoom mais data ne marche pas...pkoi ?\n          console.log('classe fermée :', username)\n          socket.broadcast.to(roomID).emit('closeRoom', (username))\n        });\n      } else {\n        //Ne marche pas...trouver la solution\n        console.log(\"c'est la merde\")\n      }\n    });\n  });\n\n  return io\n}\n\nmodule.exports = connectIO;\n\n","module.exports = require(\"bcrypt\");","module.exports = require(\"body-parser\");","module.exports = require(\"cookie-parser\");","module.exports = require(\"cors\");","module.exports = require(\"express\");","module.exports = require(\"express-mysql-session\");","module.exports = require(\"express-session\");","module.exports = require(\"express-validator\");","module.exports = require(\"moment\");","module.exports = require(\"morgan\");","module.exports = require(\"mysql\");","module.exports = require(\"passport\");","module.exports = require(\"passport-local\");","module.exports = require(\"socket.io\");"],"sourceRoot":""}
>>>>>>> Stashed changes
