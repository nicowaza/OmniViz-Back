{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/api/helpers/db.connexion.js","webpack:///./src/api/users.js","webpack:///./src/index.js","webpack:///external \"cors\"","webpack:///external \"express\"","webpack:///external \"morgan\"","webpack:///external \"mysql\"","webpack:///external \"passport\"","webpack:///external \"passport-ldapauth\""],"names":["mysql","require","connection","createConnection","host","user","password","database","connect","err","console","log","query","result","module","exports","userRouter","express","Router","get","req","res","results","fields","status","send","message","content","post","body","username","firstname","lastname","avatarUrl","university","role","LdapStrategy","app","port","process","env","PORT","use","morgan","cors","json","urlencoded","extended","getLDAPConfiguration","callback","nextTick","opts","server","url","bindDn","bindCredentials","searchBase","searchFilter","reconnect","passport","done","info","serializeUser","uid","deserializeUser","id","User","findOne","exec","then","Error","authenticate","session","error","data","listen"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","'user strict'\n\nconst mysql = require('mysql');\n\nconst connection = mysql.createConnection({\n  host: \"localhost\",\n  user: \"root\",\n  password: \"\",\n  database: \"OmnivizTest\",\n});\n\nconnection.connect(function(err) {\n  if (err) throw err;\n  console.log(\"DB Connected!\");\n\n  // crÃ©ation de la dB\n  connection.query(\"CREATE DATABASE IF NOT EXISTS OmnivizTest CHARACTER SET 'utf8'\", function (err, result) {\n    if (err) throw err;\n    console.log(\"database created\");\n  });\n\n  connection.query(\"CREATE TABLE IF NOT EXISTS OmnivizTest.users (userID INT NOT NULL UNIQUE AUTO_INCREMENT, username VARCHAR(50) NOT NULL UNIQUE, createdat TIMESTAMP, firstname VARCHAR(255) NOT NULL, lastname VARCHAR(255) NOT NULL, avatarUrl VARCHAR(500), university VARCHAR(255), password VARCHAR(40) NOT NULL, role VARCHAR(30))\", function(err, result) {\n    if (err) throw err;\n    console.log(\"Table users created\")\n  })\n});\n\nmodule.exports = connection","import express from 'express';\nimport passport from 'passport';\nimport connection from './helpers/db.connexion';\nconst mysql = require('mysql')\n\nexport const userRouter = express.Router();\n\n\nuserRouter.get('/', (req, res) => {\n  connection.query('SELECT * FROM users ', (err, results, fields) => {\n    if (err) {\n      console.log(err);\n      res.status(400).send({ status: false, message: 'User not created'})\n      // res.send({\n      //   err\n      // })\n    }else {\n      console.log(results)\n      res.status(200).send({status: true, content: results});\n    }\n  });\n});\n\nuserRouter.post('/', (req, res) => {\n  const body = req.body;\n  let username = body.username;\n  let password = body.password;\n  let firstname = body.firstname;\n  let lastname = body.lastname;\n  let avatarUrl = body.avatarUrl;\n  let university = body.university;\n  let role = body.role;\n\n  if (!username || !password) {\n    res.status(412).send('Username and password are missing')\n  }else{\n\n    let query = `INSERT INTO users (username, password, firstname, lastname, avatarUrl, university, role) VALUES ('${username}', '${password}', '${firstname}', '${lastname}', '${avatarUrl}', '${university}', '${role}')`;\n\n    connection.query(query, (err, results, fields) => {\n      if (err) {\n        console.log(err);\n        res.status(400).send({ status: false, message: 'User not created'})\n        // res.send({\n        //   err\n        // })\n      }else{\n        console.log(results);\n        res.send({\n          status:200,\n          \"success\":\"new user registered sucessfully\",\n          content: results\n        });\n      }\n    })\n  }\n})","import express from 'express';\nimport cors from 'cors';\nimport morgan from 'morgan';\nimport { userRouter } from './api/users';\nimport connection from './api/helpers/db.connexion';\nimport passport from 'passport'\nconst LdapStrategy = require('passport-ldapauth');\n\nconst app = express();\n\nconst port = process.env.PORT || 5000;\n\napp.use(morgan('combined'));\napp.use(cors());\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\n\napp.use('/users', userRouter);\n\nlet getLDAPConfiguration = function (req, callback) {\n  process.nextTick(function () {\n    var opts = {\n      server: {\n        url: \"ldap://127.0.0.1:4000\",\n        bindDn: `uid=${req.body.username}`,\n        bindCredentials: `${req.body.password}`,\n        searchBase: 'test',\n        searchFilter: `uid=${req.body.username}`,\n        reconnect: true\n      }\n    };\n    callback(null, opts);\n  });\n};\n\npassport.use(new LdapStrategy(getLDAPConfiguration,\n  function (user, done) {\n    morgan.info(\"LDAP user \", user.username, \"is logged in.\")\n    return done(null, user);\n  }))\n\n  passport.serializeUser(function (user, done) {\n    done(null, user.uid)\n  })\n  passport.deserializeUser(function (id, done) {\n    User.findOne({ uid: id }).exec()\n      .then(user => {\n        if (!user) {\n          done(new Error(`Cannot find user with uid=${id}`))\n        } else {\n          done(null, user)\n        }\n      })\n  })\n\n\n  app.post('/login', passport.authenticate('ldapauth', {session: false}), function(req, res) {\n    res.send({\n      error: err,\n      status: 'ok',\n      content: data\n    });\n  });\n\napp.listen(port, () => console.log(`server is running on port ${port}`))","module.exports = require(\"cors\");","module.exports = require(\"express\");","module.exports = require(\"morgan\");","module.exports = require(\"mysql\");","module.exports = require(\"passport\");","module.exports = require(\"passport-ldapauth\");"],"sourceRoot":""}